<div class="card mb-5">
    <div class="row text-center">
        <h3>{{ viewDate | calendarDate:(view + 'ViewTitle'):'ru-MD' }}</h3>
        <div class="flex justify-content-between mb-5">
            <div class="text-left">
                <div class="text-left mb-3">
                    <p-autoComplete (completeMethod)="filterRooms($event)"
                                    [(ngModel)]="selectRoom"
                                    [dropdown]="true"
                                    [suggestions]="filteredRooms"
                                    [size]="40"
                                    [virtualScroll]="true"
                                    [virtualScrollItemSize]="40"
                                    (onSelect)="filteredEventsForRooms(selectRoom)"
                                    field="name"
                                    placeholder="Выбрать помещение"
                    ></p-autoComplete>
                </div>
                <span class="p-buttonset">
				<button (viewDateChange)="closeOpenMonthViewDay()"
                        [(viewDate)]="viewDate"
                        [view]="view"
                        icon="pi pi-chevron-left"
                        label="Назад"
                        mwlCalendarPreviousView
                        pButton
                        pRipple
                ></button>
				<button [(viewDate)]="viewDate"
                        class="p-button-outlined"
                        mwlCalendarToday
                        pButton
                        pRipple
                >{{nowDate | calendarDate:(view + 'ViewTitle'):'ru-MD' }}</button>
            <button (viewDateChange)="closeOpenMonthViewDay()"
                    [(viewDate)]="viewDate"
                    [view]="view"
                    icon="pi pi-chevron-right"
                    iconPos="right"
                    label="Вперед"
                    mwlCalendarNextView
                    pButton
                    pRipple
            ></button>
    </span>
            </div>
            <div>
                <div class="text-left mb-3 ">
                    <p-autoComplete (completeMethod)="filterItems($event)"
                                    [(ngModel)]="selectItem"
                                    [dropdown]="true"
                                    [suggestions]="filteredItems"
                                    [virtualScroll]="true"
                                    [virtualScrollItemSize]="40"

                                    field="label"
                                    placeholder="Выбрать сотрудника"
                    ></p-autoComplete>
                </div>
                <span class="p-buttonset flex mb-3">
				    <button (click)="setView(CalendarView.Month)"
                            [class.active]="view === CalendarView.Month"
                            class="w-10"
                            label="Месяц"
                            pButton
                            pRipple
                    ></button>
                    <button (click)="setView(CalendarView.Week)"
                            [class.active]="view === CalendarView.Week"
                            class="w-10"
                            label="Неделя"
                            pButton
                            pRipple
                    ></button>
                    <button (click)="setView(CalendarView.Day)"
                            [class.active]="view === CalendarView.Day"
                            class="w-10"
                            label="День"
                            pButton
                            pRipple
                    ></button>
                </span>
                <div class=" mb-5">
                    <p-splitButton [model]="options"
                                   icon="pi pi-plus"
                                   label="Добавить событие"
                                   styleClass="p-button-success w-full"
                    ></p-splitButton>
                </div>
            </div>

        </div>

        <p-divider></p-divider>

    </div>

    <div [ngSwitch]="view"
         class="mt-5">
        <mwl-calendar-month-view (dayClicked)="dayClicked($event.day)"
                                 (eventClicked)="handleEvent('Clicked', $event.event)"
                                 (eventTimesChanged)="eventTimesChanged($event)"
                                 *ngSwitchCase="CalendarView.Month"
                                 [activeDayIsOpen]="activeDayIsOpen"
                                 [events]="events"
                                 [locale]="locale"
                                 [refresh]="refresh"
                                 [viewDate]="viewDate"
                                 [weekStartsOn]="weekStartsOn"
        ></mwl-calendar-month-view>
        <mwl-calendar-week-view (eventClicked)="handleEvent('Clicked', $event.event)"
                                (eventTimesChanged)="eventTimesChanged($event)"
                                *ngSwitchCase="CalendarView.Week"
                                [events]="events"
                                [locale]="locale"
                                [refresh]="refresh"
                                [viewDate]="viewDate"
        ></mwl-calendar-week-view>
        <mwl-calendar-day-view (eventClicked)="handleEvent('Clicked', $event.event)"
                               (eventTimesChanged)="eventTimesChanged($event)"
                               *ngSwitchCase="CalendarView.Day"
                               [events]="events"
                               [locale]="locale"
                               [refresh]="refresh"
                               [viewDate]="viewDate"
        ></mwl-calendar-day-view>
    </div>
</div>
<p-dialog *ngIf="endLoading"
          [(visible)]="display"
          [breakpoints]="{ '960px': '75vw' }"
          [modal]="true"
          [style]="{ width: '50vw', height: '80vh', 'text-align': 'start' }"
          header="Карточка события"
          showEffect="fade"
          showEffect="fade"
>
    <div class="card">
        <div class="grid formgrid">
            <div class="col mb-5">
                <h5>Название события</h5>
                <input *ngIf="isChange"
                       [(ngModel)]="eventDetail.title"
                       class="w-full"
                       pInputText
                       type="text"
                />
                <p *ngIf="!isChange">{{eventDetail.title}}</p>
            </div>
            <div class="col mb-5 w-full">
                <h5>Начало проведения события</h5>
                <p-calendar *ngIf="isChange"
                            [(ngModel)]="testInfo"
                            [showTime]="true"
                            styleClass="w-full"
                ></p-calendar>
                <p *ngIf="!isChange">{{testInfo | date: 'dd.MM.YY HH:mm'}}</p>
            </div>
    </div>
    <div class="grid formgrid">
        <div class="col mb-5">
            <h5>Описание события</h5>
            <textarea *ngIf="isChange"
                      [(ngModel)]="eventDetail.desc"
                      pInputTextarea
                      style="width: 100%"
            ></textarea>
            <p *ngIf="!isChange">{{eventDetail.desc}}</p>
        </div>
        <div class="col mb-2">
            <h5>Помещение</h5>
            <p-autoComplete (completeMethod)="filterCountry($event)"
                            *ngIf="isChange"
                            [(ngModel)]="eventDetail.className.name"
                            [dropdown]="true"
                            [suggestions]="filteredCountries"
                            field="name"
                            styleClass="w-full"
            ></p-autoComplete>
            <p *ngIf="!isChange">{{eventDetail.className.name}}</p>
        </div>
    </div>
    <div class="grid formgrid">
        <div class="col mb-5">
            <h5>Организация</h5>
            <p-autoComplete (completeMethod)="filterCountry($event)"
                            *ngIf="isChange"
                            [(ngModel)]="selectedCountryAdvanced"
                            [dropdown]="true"
                            [suggestions]="filteredCountries"
                            field="name"
                            styleClass="w-full"
            ></p-autoComplete>
            <p *ngIf="!isChange">{{selectedCountryAdvanced}}</p>
        </div>
        <div class="col mb-2">
            <h5>Компания</h5>
            <p-dropdown *ngIf="isChange"
                        [(ngModel)]="eventDetail.className.name"
                        [options]="cities"
                        optionLabel="name"
                        styleClass="w-full"
            ></p-dropdown>
            <p *ngIf="!isChange">{{eventDetail.className.name}}</p>
        </div>
    </div>
    </div>
    <p-tabMenu (activeItemChange)="onActiveItemChange($event)"
               [activeItem]="activeItem"
               [model]="items"
               styleClass="align-center"
    ></p-tabMenu>
    <div class="card mt-5">
        <div *ngIf="this.activeItem.label === 'Участники'">
            <h5>{{activeItem.label}}</h5>
            <p-table #dt1
                     [globalFilterFields]="['dateStart', 'eventTitle', 'venue', 'author']"
                     [loading]="loading"
                     [paginator]="true"
                     [rowHover]="true"
                     [rows]="10"
                     [value]="people"
                     dataKey="id"
                     responsiveLayout="scroll"
                     styleClass="p-datatable-gridlines"
            >
                <ng-template
                        class="flex"
                        pTemplate="caption"
                >
                    <div class="flex align-items-center justify-content-end">
              <span class="p-input-icon-left mb-2">
            <i class="pi pi-search"></i>
            <input #filter
                   (input)="onGlobalFilter(dt1, $event)"
                   class="w-full"
                   pInputText
                   placeholder="Поиск"
                   type="text"
            />
          </span>
          </div>
        </ng-template>
        <ng-template pTemplate="header">
          <tr>
            <th class="text-center">№</th>

            <th>
              <div class="flex justify-content-between align-items-center">Уведомлен
              </div>
            </th>

            <th style="min-width: 14rem">
              <div class="flex justify-content-between align-items-center">
                <span>Сотрудник</span>
                <p-columnFilter
                  display="menu"
                  field="author"
                  placeholder="Поиск месту проведения"
                  type="text"
                ></p-columnFilter>
              </div>
            </th>
            <th class="text-center">
              <span>Дополнительно</span>
            </th>
          </tr>
        </ng-template>
        <ng-template
          let-event
          pTemplate="body"
        >
          <tr>
            <td>
              {{ 1 }}
            </td>
            <td>
              {{ 'done' }}
            </td>
            <td>
              <p-avatar
                [label]="event.author[0]"
                shape="circle"
                size="small"
              ></p-avatar>
              <span
                class="image-text ml-2"
              >{{ event.author }}
                            </span>
            </td>

            <td class="text-center">
              <!--                            <app-event-card [event]="event"></app-event-card>-->
            </td>
          </tr>
        </ng-template>
        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="8">Данные не найдены</td>
          </tr>
        </ng-template>
        <ng-template pTemplate="loadingbody">
          <tr>
            <td colspan="8">Загрузка данных...</td>
          </tr>
        </ng-template>
      </p-table>
    </div>

    <div *ngIf="this.activeItem.label === 'Информация к событию'">
      <h5>{{activeItem.label}}</h5>
      <p-table
        #dt1
        [globalFilterFields]="['dateStart', 'eventTitle', 'venue', 'author']"
        [loading]="loading"
        [paginator]="true"
        [rowHover]="true"
        [rows]="10"
        [value]="people"
        dataKey="id"
        responsiveLayout="scroll"
        styleClass="p-datatable-gridlines"
      >
        <ng-template
          class="flex"
          pTemplate="caption"
        >
          <div class="flex align-items-center justify-content-end">
                        <span class="p-input-icon-left mb-2">
            <i class="pi pi-search"></i>
            <input
              #filter
              (input)="onGlobalFilter(dt1, $event)"
              class="w-full"
              pInputText
              placeholder="Поиск"
              type="text"
            />
          </span>
          </div>
        </ng-template>
        <ng-template pTemplate="header">
          <tr>
            <th class="text-center">№</th>
            <th style="min-width: 14rem">
              <div class="flex justify-content-between align-items-center">Файл</div>
            </th>
            <th style="min-width: 14rem">
              <div class="flex justify-content-between align-items-center">
                Сотрудник
                <p-columnFilter
                  display="menu"
                  field="author"
                  placeholder="Поиск месту проведения"
                  type="text"
                ></p-columnFilter>
              </div>
            </th>

            <th class="text-center"
                style="min-width: 12rem">
              <span>Дополнительно</span>
            </th>
          </tr>
        </ng-template>
        <ng-template
          let-event
          pTemplate="body"
        >
          <tr>
            <td>
              {{ 1 }}
            </td>
            <td>
              {{ 'done' }}
            </td>
            <td>
              <p-avatar
                [label]="event.author[0]"
                shape="circle"
                size="small"
              ></p-avatar>
              <span
                class="image-text ml-2"
              >{{ event.author }}
                            </span>
            </td>

            <td class="text-center">
              <!--                            <app-event-card [event]="event"></app-event-card>-->
            </td>
          </tr>
        </ng-template>
        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="8">Данные не найдены</td>
          </tr>
        </ng-template>
        <ng-template pTemplate="loadingbody">
          <tr>
            <td colspan="8">Загрузка данных...</td>
          </tr>
        </ng-template>
      </p-table>
    </div>

    <div *ngIf="this.activeItem.label === 'Оценка'">
      <h5>{{activeItem.label}}</h5>

      <div class="flex justify-content-between mb-3">
        <p-autoComplete
          (completeMethod)="filterCountry($event)"
          [(ngModel)]="selectedCountryAdvanced"
          [dropdown]="true"
          [suggestions]="filteredCountries"
          class="w-8"
          field="name"
          placeholder="Нарушение"
          styleClass="w-12"
        ></p-autoComplete>
        <input
          class="w-3"
          pInputText
          placeholder="Сумма"
          type="text"
        />
      </div>
      <div class="flex justify-content-between mb-3">
        <p-autoComplete
          (completeMethod)="filterCountry($event)"
          [(ngModel)]="selectedCountryAdvanced"
          [dropdown]="true"
          [suggestions]="filteredCountries"
          class="w-8"
          field="name"
          placeholder="Участник"
          styleClass="w-12"
        ></p-autoComplete>
        <input
          class="w-3"
          pInputText
          placeholder="Часов просрочки"
          type="text"
        />
      </div>
      <div class="flex justify-content-between mb-3">
        <input
          class="w-8"
          pInputText
          placeholder="Комментарий"
          type="text"
        />
        <button pButton>Добавить</button>
      </div>
    </div>

    <div *ngIf="this.activeItem.label === 'Протокол'">
      <h5>{{activeItem.label}}</h5>
      <div>
        <p-fileUpload
          (onUpload)="onUpload($event)"
          [maxFileSize]="1000000"
          [multiple]="true"
          accept=".pdf, .doc, .docx"
          name="demo[]"
          url="./upload.php">
          <ng-template pTemplate="content">
            <ul *ngIf="uploadedFiles.length">
              <li *ngFor="let file of uploadedFiles">{{file.name}} - {{file.size}}
                байт
              </li>
            </ul>
          </ng-template>
        </p-fileUpload>
      </div>
      <div>
        <div class="flex justify-content-between mb-5">
          <p>Название файла</p>
          <button
            class="p-button-warning"
            icon="pi pi-save"
            pButton>
          </button>
        </div>
        <div class="flex justify-content-end">
          <button
            (click)="visibleModification = true"
            class="p-button-danger mr-2"
            icon="pi pi-exclamation-circle"
            label="Отправить на доработку"
            pButton>
          </button>
          <button
            icon="pi pi-check"
            label="Утвердить"
            pButton>
          </button>

        </div>
      </div>
    </div>
  </div>
  <ng-template pTemplate="footer">
    <button pButton (click)="isChange = !isChange">Изменить</button>
    <button
      (click)="display = false"
      class="p-button-outlined p-button-danger"
      icon="pi pi-times"
      label="Отменить"
      pButton
    ></button>
    <button
      (click)="display = false"
      class="p-button-outlined"
      icon="pi pi-copy"
      label="Копировать"
      pButton
    ></button>
    <button
      (click)="display = false"
      class="p-button-outlined p-button-success"
      icon="pi pi-check"
      label="Сохранить"
      pButton
    ></button>
  </ng-template>
</p-dialog>
